<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.extensionblocker.mapper.ExtensionRuleMapper">

    <resultMap id="ExtensionRuleResult" type="com.example.extensionblocker.model.ExtensionRule">
        <id property="id" column="id"/>
        <result property="policyId" column="policy_id"/>
        <result property="extension" column="extension"/>
        <result property="type" column="type"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <insert id="regExtensionRule" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO extension_rule 
        ( policy_id
        , extension
        , type
        , created_at)
        VALUES 
        ( #{policyId}
        , #{extension}
        , #{type}
        , CURRENT_TIMESTAMP)
    </insert>

    <select id="getRulesByPolicyId" resultMap="ExtensionRuleResult">
        SELECT id
             , policy_id
             , extension
             , type
             , created_at
          FROM extension_rule 
         WHERE policy_id = #{policyId}
    </select>

    <select id="getRuleByPolicyIdAndExtension" resultMap="ExtensionRuleResult">
        SELECT id
             , policy_id
             , extension
             , type
             , created_at
          FROM extension_rule 
         WHERE policy_id = #{policyId} 
           AND extension = #{extension}
    </select>

    <select id="getCountByPolicyIdAndType" resultType="long">
        SELECT COUNT(*) 
          FROM extension_rule 
         WHERE policy_id = #{policyId} 
           AND type = #{type}
    </select>

    <select id="getRuleById" resultMap="ExtensionRuleResult">
        SELECT id
             , policy_id
             , extension
             , type
             , created_at
          FROM extension_rule 
         WHERE id = #{id}
    </select>

    <delete id="delExtensionRuleById">
        DELETE FROM extension_rule 
         WHERE id = #{id}
    </delete>

</mapper>
