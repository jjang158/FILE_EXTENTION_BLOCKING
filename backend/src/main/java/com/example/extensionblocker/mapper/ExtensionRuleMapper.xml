<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.extensionblocker.mapper.ExtensionRuleMapper">

    <resultMap id="ExtensionRuleResult" type="com.example.extensionblocker.entity.ExtensionRule">
        <id property="id" column="id"/>
        <result property="policyId" column="policy_id"/>
        <result property="extension" column="extension"/>
        <result property="type" column="type"/>
        <result property="isActive" column="is_active"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO extension_rule (policy_id, extension, type, is_active, created_at)
        VALUES (#{policyId}, #{extension}, #{type}, #{isActive}, CURRENT_TIMESTAMP)
    </insert>

    <select id="findByPolicyId" resultMap="ExtensionRuleResult">
        SELECT * FROM extension_rule WHERE policy_id = #{policyId}
    </select>

    <select id="findByPolicyIdAndExtension" resultMap="ExtensionRuleResult">
        SELECT * FROM extension_rule WHERE policy_id = #{policyId} AND extension = #{extension}
    </select>

    <select id="countByPolicyIdAndType" resultType="long">
        SELECT COUNT(*) FROM extension_rule WHERE policy_id = #{policyId} AND type = #{type}
    </select>

    <update id="updateActiveStatus">
        UPDATE extension_rule SET is_active = #{isActive} WHERE id = #{id}
    </update>

    <select id="findById" resultMap="ExtensionRuleResult">
        SELECT * FROM extension_rule WHERE id = #{id}
    </select>

    <delete id="deleteById">
        DELETE FROM extension_rule WHERE id = #{id}
    </delete>

</mapper>
